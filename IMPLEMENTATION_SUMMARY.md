# Quest VRåŒæ¨¡å¼è¾“å…¥æ³•å®ç°æ€»ç»“

## ğŸ‰ å®ç°å®Œæˆ

å·²æˆåŠŸä¸ºè¾“å…¥æ³•æ·»åŠ äº†åŒæ¨¡å¼æ”¯æŒï¼š
- **ä¼ ç»Ÿæ‚¬æµ®çª—æ¨¡å¼**ï¼šåŸæœ‰çš„æ‚¬æµ®çª—æ˜¾ç¤ºæ–¹å¼
- **Quest VRæ¨¡å¼**ï¼šä½¿ç”¨ç‹¬ç«‹Activityä½œä¸ºé”®ç›˜ç•Œé¢ï¼Œä¸“ä¸ºVRè®¾å¤‡ä¼˜åŒ–

## âœ… æ ¸å¿ƒåŠŸèƒ½

### 1. æ¨¡å¼åˆ‡æ¢
- ç”¨æˆ·å¯åœ¨è®¾ç½®ä¸­é€‰æ‹©è¾“å…¥æ¨¡å¼
- æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢
- è‡ªåŠ¨å¤„ç†æ¨¡å¼åˆ‡æ¢æ—¶çš„èµ„æºæ¸…ç†

### 2. Quest VRæ¨¡å¼ç‰¹æ€§
- **ç‹¬ç«‹Activityé”®ç›˜**ï¼šä¸æŠ¢å ç„¦ç‚¹ï¼Œä¿æŒåŸè¾“å…¥æ¡†æœ‰æ•ˆ
- **è°ƒç”¨è€…è¿½è¸ª**ï¼šè®°å½•è°ƒç”¨åº”ç”¨ä¿¡æ¯ï¼Œæ”¯æŒè·¨Activityè¾“å…¥
- **å®æ—¶è¾“å…¥**ï¼šç«‹å³é¢„è§ˆ + å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿æµç•…ä½“éªŒ
- **è‡ªåŠ¨å›é€€**ï¼šQuestæ¨¡å¼å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°æ‚¬æµ®çª—æ¨¡å¼

### 3. æŠ€æœ¯æ¶æ„
```
Questæ¨¡å¼æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç›®æ ‡åº”ç”¨      â”‚    â”‚   è¾“å…¥æ³•æœåŠ¡     â”‚    â”‚ Questé”®ç›˜Activityâ”‚
â”‚                 â”‚    â”‚                  â”‚    â”‚                 â”‚
â”‚ è¯·æ±‚é”®ç›˜ â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â†’â”‚ è®°å½•è°ƒç”¨è€…ä¿¡æ¯   â”‚    â”‚ æ˜¾ç¤ºé”®ç›˜ç•Œé¢    â”‚
â”‚                 â”‚    â”‚ å¯åŠ¨Quest Activityâ”‚    â”‚                 â”‚
â”‚ æ¥æ”¶è¾“å…¥ â†â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”‚ è½¬å‘è¾“å…¥æ“ä½œ     â”‚â†â”€â”€â”€â”‚ ç”¨æˆ·è¾“å…¥        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ–‡ä»¶ç»“æ„

### æ–°å¢æ–‡ä»¶
```
yuyansdk/src/main/java/com/yuyan/imemodule/quest/
â”œâ”€â”€ QuestKeyboardActivity.kt          # ç‹¬ç«‹é”®ç›˜Activity
â”œâ”€â”€ KeyboardCallerTracker.kt          # è°ƒç”¨è€…è¿½è¸ªå™¨
â”œâ”€â”€ QuestImeServiceAdapter.kt         # è¾“å…¥æœåŠ¡é€‚é…å™¨
â”œâ”€â”€ QuestInputInterface.kt            # è¾“å…¥æ¥å£å®šä¹‰
â””â”€â”€ QuestModeTest.kt                  # æµ‹è¯•å·¥å…·

æ–‡æ¡£æ–‡ä»¶ï¼š
â”œâ”€â”€ QUEST_MODE_README.md              # è¯¦ç»†ä½¿ç”¨è¯´æ˜
â””â”€â”€ IMPLEMENTATION_SUMMARY.md         # å®ç°æ€»ç»“ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

### ä¿®æ”¹æ–‡ä»¶
```
yuyansdk/src/main/java/com/yuyan/imemodule/
â”œâ”€â”€ prefs/AppPrefs.kt                 # æ·»åŠ Questæ¨¡å¼é…ç½®
â”œâ”€â”€ service/ImeService.kt             # é›†æˆQuestæ¨¡å¼é€»è¾‘
â”œâ”€â”€ ui/fragment/KeyboardSettingFragment.kt  # æ·»åŠ è®¾ç½®ç›‘å¬å™¨
â””â”€â”€ src/main/res/
    â”œâ”€â”€ values/strings.xml            # æ·»åŠ å­—ç¬¦ä¸²èµ„æº
    â””â”€â”€ AndroidManifest.xml           # æ³¨å†ŒQuest Activity
```

## ğŸ”§ å…³é”®æŠ€æœ¯å®ç°

### 1. é˜²æ­¢ç„¦ç‚¹æŠ¢å 
```kotlin
window.setFlags(
    WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE or 
    WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL,
    WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE or 
    WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL
)
```

### 2. è°ƒç”¨è€…è¿½è¸ª
```kotlin
// è®°å½•è°ƒç”¨è€…ä¿¡æ¯
fun recordCaller(packageName: String, inputConnection: InputConnection?) {
    if (packageName == "com.vr369" || packageName.contains("yuyan")) {
        return // è¿‡æ»¤è‡ªèº«åº”ç”¨
    }
    callerPackageName = packageName
    callerInputConnection = inputConnection
    lastCallTime = System.currentTimeMillis()
}
```

### 3. æ™ºèƒ½è¾“å…¥è·¯ç”±
```kotlin
fun commitText(text: String) {
    val convertedText = StringUtils.converted2FlowerTypeface(text)
    if (shouldUseQuestMode() && KeyboardCallerTracker.instance.hasValidCaller()) {
        KeyboardCallerTracker.instance.pasteToTargetInputField(convertedText)
    } else {
        currentInputConnection.commitText(convertedText, 1)
    }
}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¯ç”¨Questæ¨¡å¼
1. æ‰“å¼€è¾“å…¥æ³•è®¾ç½®
2. è¿›å…¥"é”®ç›˜è®¾ç½®"
3. æ‰¾åˆ°"Quest VRæ¨¡å¼"åˆ†ç±»
4. å¯ç”¨"å¯ç”¨Questæ¨¡å¼"

### å¼€å‘è€…æµ‹è¯•
```kotlin
// è¿è¡Œå®Œæ•´æµ‹è¯•
QuestModeTest.runAllTests()

// éªŒè¯é›†æˆçŠ¶æ€
val isValid = QuestModeTest.validateQuestModeIntegration()
if (isValid) {
    Log.d("Test", "Questæ¨¡å¼é›†æˆæ­£å¸¸")
} else {
    Log.e("Test", "Questæ¨¡å¼é›†æˆæœ‰é—®é¢˜")
}
```

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### å…³é”®æ—¥å¿—æ ‡ç­¾
- `QuestKeyboardActivity`: Activityç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€
- `KeyboardCallerTracker`: è°ƒç”¨è€…è¿½è¸ªå’Œè¾“å…¥æ“ä½œ
- `ImeService`: æ¨¡å¼åˆ‡æ¢å’Œè¾“å…¥è·¯ç”±
- `QuestModeTest`: æµ‹è¯•ç»“æœå’ŒéªŒè¯

### å¸¸è§é—®é¢˜æ’æŸ¥
1. **Questæ¨¡å¼æ— æ³•å¯åŠ¨**
   - æ£€æŸ¥æ‚¬æµ®çª—æƒé™
   - æŸ¥çœ‹ImeServiceæ˜¯å¦æ­£å¸¸è¿è¡Œ
   - æ£€æŸ¥Activityæ³¨å†Œæ˜¯å¦æ­£ç¡®

2. **è¾“å…¥æ— å“åº”**
   - éªŒè¯KeyboardCallerTrackerçŠ¶æ€
   - æ£€æŸ¥InputConnectionæœ‰æ•ˆæ€§
   - ç¡®è®¤æ¨¡å¼è®¾ç½®æ­£ç¡®

3. **æ¨¡å¼åˆ‡æ¢å¤±è´¥**
   - é‡å¯è¾“å…¥æ³•æœåŠ¡
   - æ¸…é™¤åº”ç”¨æ•°æ®
   - æ£€æŸ¥é…ç½®æ–‡ä»¶

## ğŸ“Š æ€§èƒ½å’Œå…¼å®¹æ€§

### æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨åç¨‹å¤„ç†å¼‚æ­¥æ“ä½œ
- å®ç°è¿æ¥è¶…æ—¶å’Œè‡ªåŠ¨æ¸…ç†
- å»¶è¿Ÿæ‰§è¡Œå‡å°‘ç³»ç»Ÿè´Ÿæ‹…
- æ™ºèƒ½å›é€€æœºåˆ¶

### å…¼å®¹æ€§
- æ”¯æŒAndroid API 21+
- å…¼å®¹ç°æœ‰æ‚¬æµ®çª—æ¨¡å¼
- å‘åå…¼å®¹åŸæœ‰åŠŸèƒ½
- VRè®¾å¤‡ç‰¹æ®Šä¼˜åŒ–

## ğŸ¯ æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•
1. æ¨¡å¼åˆ‡æ¢æµ‹è¯•
2. ä¸åŒåº”ç”¨è¾“å…¥æµ‹è¯•
3. é•¿æ—¶é—´ä½¿ç”¨ç¨³å®šæ€§æµ‹è¯•
4. å¼‚å¸¸æƒ…å†µæ¢å¤æµ‹è¯•

### æ€§èƒ½æµ‹è¯•
1. å†…å­˜ä½¿ç”¨ç›‘æ§
2. CPUå ç”¨æµ‹è¯•
3. ç”µæ± æ¶ˆè€—è¯„ä¼°
4. å“åº”æ—¶é—´æµ‹é‡

## ğŸ”® æœªæ¥æ‰©å±•

### å¯èƒ½çš„æ”¹è¿›æ–¹å‘
1. æ·»åŠ æ›´å¤šVRè®¾å¤‡é€‚é…
2. ä¼˜åŒ–è¾“å…¥å»¶è¿Ÿ
3. å¢åŠ æ‰‹åŠ¿æ”¯æŒ
4. æ·»åŠ è¯­éŸ³è¾“å…¥é›†æˆ

### ç»´æŠ¤å»ºè®®
1. å®šæœŸæ›´æ–°å…¼å®¹æ€§
2. ç›‘æ§ç”¨æˆ·åé¦ˆ
3. æ€§èƒ½æŒç»­ä¼˜åŒ–
4. å®‰å…¨æ€§å®¡æŸ¥

## ğŸ“ ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬**: v1.0
- **æ„å»ºçŠ¶æ€**: âœ… æˆåŠŸ
- **æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡
- **æ–‡æ¡£çŠ¶æ€**: âœ… å®Œæ•´

---

**å®ç°å®Œæˆæ—¶é—´**: 2025-07-12  
**æŠ€æœ¯æ ˆ**: Kotlin, Android SDK, InputMethodService  
**ç‰¹æ®Šæ„Ÿè°¢**: Quest VRæŠ€æœ¯å‚è€ƒå®ç°
